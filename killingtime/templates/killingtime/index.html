{%extends 'base.html'%}
{% block body_block %}

    
<div class = "mapcontainer" id="map" style="width:100%;height:100%;"></div>

	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8fad6c5fcb014eb0be53048d3f5a5821"></script>
	<script>
	
		var container = document.getElementById('map');
		var loc = {{location}}
		
		// Check Mobile Device for geolocation(Web's gps is not perfect.)
		var isMobile = {
            Android: function() {
                return navigator.userAgent.match(/Android/i);
            },
            BlackBerry: function() {
                return navigator.userAgent.match(/BlackBerry/i);
            },
            iOS: function() {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i);
            },
            Opera: function() {
                return navigator.userAgent.match(/Opera Mini/i);
            },
            Windows: function() {
                return navigator.userAgent.match(/IEMobile/i);
            },
            any: function() {
                return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
            }
        };

	    curloc = [0,0]
	    if ("geolocation" in navigator && isMobile.any()) {
            /* geolocation O */
            // console.log('geolocation yes!')
            navigator.geolocation.getCurrentPosition(function(position) {
                curloc[0] = position.coords.latitude
                curloc[1] = position.coords.longitude
                mapSetting(loc, curloc)
            });
        } else {
            /* geolocation X */
            // console.log('geolocation no!')

            for(var i = 0;i<loc.length;i++){
                curloc[0] += loc[i][0]
                curloc[1] += loc[i][1]
            }
            curloc[0] /= loc.length
            curloc[1] /= loc.length
            mapSetting(loc, curloc)
        }
        
        
        function mapSetting(loc, curloc){
            
            // Map setting
    		var options = {
    			center: new daum.maps.LatLng(curloc[0], curloc[1]),
    			level: 3
    		};
            var map = new daum.maps.Map(container, options);
            
            
            // Marker postions setting
            var positions = new Array()
            for(var i = 0;i<loc.length;i++){
                positions.push({title:"", latlng:new daum.maps.LatLng(loc[i][0], loc[i][1])})
            }
    		
            for(var i = 0;i<loc.length;i++){
                var marker = new daum.maps.Marker({
                    map: map, // 마커를 표시할 지도
                    position: positions[i].latlng, // 마커를 표시할 위치
                    title : positions[i].title, 
                });
            }
            
            
            // Marker lines settings
            var linePath = new Array()
            
            for(var i = 0;i<loc.length;i++){
                linePath.push(positions[i].latlng)
            }
            
            // 지도에 표시할 선을 생성합니다
            var polyline = new daum.maps.Polyline({
                path: linePath, // 선을 구성하는 좌표배열 입니다
                strokeWeight: 5, // 선의 두께 입니다
                strokeColor: '#FFAE00', // 선의 색깔입니다
                strokeOpacity: 0.7, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
                strokeStyle: 'solid' // 선의 스타일입니다
            });
            
            // Show lines on map
            polyline.setMap(map);  
            
            
        }

	</script>
{% endblock %}
